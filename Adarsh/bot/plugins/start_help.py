from Adarsh.bot import StreamBot
from Adarsh.vars import Var
import logging
from pyrogram import filters
from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from pyrogram.errors import UserNotParticipant
from Adarsh.utils.database import Database
from Adarsh.utils.file_properties import get_name, get_hash, get_media_file_size
from Adarsh.utils.human_readable import humanbytes

# Set up logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Initialize the database
db = Database(Var.DATABASE_URL, Var.name)

# Command handlers
@StreamBot.on_message(filters.command('start') & filters.private)
async def start_handler(bot, message):
    user_id = message.from_user.id
    if not await db.is_user_exist(user_id):
        await db.add_user(user_id)
        await bot.send_message(
            Var.BIN_CHANNEL,
            f"#NEW_USER: New User [{message.from_user.first_name}](tg://user?id={user_id}) Started !!"
        )
    
    # Reply to the user
    await message.reply_text(
        text="**Êœá´‡ÊŸÊŸá´...âš¡\n\nÉªá´€á´ á´€ sÉªá´á´˜ÊŸá´‡ á´›á´‡ÊŸá´‡É¢Ê€á´€á´ Ò“ÉªÊŸá´‡/á´ Éªá´…á´‡á´ á´›á´ á´˜á´‡Ê€á´á´€É´á´‡É´á´› ÊŸÉªÉ´á´‹ á´€É´á´… sá´›Ê€á´‡á´€á´ ÊŸÉªÉ´á´‹ É¢á´‡É´á´‡Ê€á´€á´›á´Ê€ Ê™á´á´›.**\n\n**á´œsá´‡ /help Ò“á´Ê€ á´á´Ê€á´‡ á´…á´‡á´›sÉªÊŸs\n\nsá´‡É´á´… á´á´‡ á´€É´Ê á´ Éªá´…á´‡á´ / Ò“ÉªÊŸá´‡ á´›á´ sá´‡á´‡ á´Ê á´˜á´á´¡á´‡Ê€á´¢...**",
        reply_markup=InlineKeyboardMarkup(
            [[InlineKeyboardButton("OWNER", url="https://t.me/expertskb")]]
        ),
    )

@StreamBot.on_message(filters.command('help') & filters.private)
async def help_handler(bot, message):
    user_id = message.from_user.id
    if not await db.is_user_exist(user_id):
        await db.add_user(user_id)
        await bot.send_message(
            Var.BIN_CHANNEL,
            f"#NEW_USER: New User [{message.from_user.first_name}](tg://user?id={user_id}) Started !!"
        )

    # Reply to the user with help message
    await message.reply_photo(
        photo="https://graph.org/file/8e67ae4a3803f69a28218.jpg",
        caption="**â”£âª¼ sá´‡É´á´… á´á´‡ á´€É´Ê Ò“ÉªÊŸá´‡/á´ Éªá´…á´‡á´ á´›Êœá´‡É´ Éª á´¡ÉªÊŸÊŸ Êá´á´œ á´˜á´‡Ê€á´á´€É´á´‡É´á´› sÊœá´€Ê€á´‡á´€Ê™ÊŸá´‡ ÊŸÉªÉ´á´‹ á´Ò“ Éªá´›...\n\nâ”£âª¼ á´›ÊœÉªs ÊŸÉªÉ´á´‹ á´„á´€É´ Ê™á´‡ á´œsá´‡á´… á´›á´ á´…á´á´¡É´ÊŸá´á´€á´… á´Ê€ á´›á´ sá´›Ê€á´‡á´€á´ á´œsÉªÉ´É¢ á´‡xá´›á´‡Ê€É´á´€ÊŸ á´ Éªá´…á´‡á´ á´˜ÊŸá´€Êá´‡Ê€s á´›ÊœÊ€á´á´œÉ¢Êœ á´Ê sá´‡Ê€á´ á´‡Ê€s.\n\nâ”£âª¼ Ò“á´Ê€ sá´›Ê€á´‡á´€á´ÉªÉ´É¢ á´Šá´œsá´› á´„á´á´˜Ê á´›Êœá´‡ ÊŸÉªÉ´á´‹ á´€É´á´… á´˜á´€sá´›á´‡ Éªá´› ÉªÉ´ Êá´á´œÊ€ á´ Éªá´…á´‡á´ á´˜ÊŸá´€Êá´‡Ê€ á´›á´ sá´›á´€Ê€á´› sá´›Ê€á´‡á´€á´ÉªÉ´É¢.\n\nâ”£âª¼ á´›ÊœÉªs Ê™á´á´› Éªs á´€ÊŸsá´ sá´œá´˜á´˜á´Ê€á´› ÉªÉ´ á´„Êœá´€É´É´á´‡ÊŸ. á´€á´…á´… á´á´‡ á´›á´ Êá´á´œÊ€ á´„Êœá´€É´É´á´‡ÊŸ á´€s á´€á´…á´ÉªÉ´ á´›á´ É¢á´‡á´› Ê€á´‡á´€ÊŸá´›Éªá´á´‡ á´…á´á´¡É´ÊŸá´á´€á´… ÊŸÉªÉ´á´‹ Ò“á´Ê€ á´‡á´ á´‡Ê€Ê Ò“ÉªÊŸá´‡s/á´ Éªá´…á´‡á´s á´˜á´sÊ../\n\nâ”£âª¼ Ò“á´Ê€ á´á´Ê€á´‡ ÉªÉ´Ò“á´Ê€á´á´€á´›Éªá´É´ :- /about\n\n\ná´˜ÊŸá´‡á´€sá´‡ sÊœá´€Ê€á´‡ á´€É´á´… sá´œÊ™sá´„Ê€ÉªÊ™á´‡**",
        reply_markup=InlineKeyboardMarkup(
            [[InlineKeyboardButton("ğŸ’  DEVELOPER", url="https://github.com/expertskb")]]
        ),
    )

@StreamBot.on_message(filters.command('about') & filters.private)
async def about_handler(bot, message):
    user_id = message.from_user.id
    if not await db.is_user_exist(user_id):
        await db.add_user(user_id)
        await bot.send_message(
            Var.BIN_CHANNEL,
            f"#NEW_USER: New User [{message.from_user.first_name}](tg://user?id={user_id}) Started !!"
        )

    # Reply to the user with about message
    await message.reply_photo(
        photo="https://graph.org/file/8e67ae4a3803f69a28218.jpg",
        caption="""<b>sá´á´á´‡ ÊœÉªá´…á´…á´‡É´ á´…á´‡á´›á´€ÉªÊŸsğŸ˜œ</b>

<b>â•­â”â”â”â”â”â”â”ã€”Ò“ÉªÊŸá´‡ á´›á´ ÊŸÉªÉ´á´‹ Ê™á´á´›ã€•</b>
â”ƒ
â”£âª¼<b>Ê™á´á´› É´á´€á´á´‡ : Ò“ÉªÊŸá´‡ á´›á´ ÊŸÉªÉ´á´‹
â”ƒ
<b>â•°â”â”â”â”â”â”â”ã€”á´˜ÊŸá´‡á´€sÊ€ sá´œá´˜á´˜á´Ê€á´›ã€•</b>""",
        reply_markup=InlineKeyboardMarkup(
            [[InlineKeyboardButton("ğŸ’  DEVELOPER", url="https://github.com/expertskb")]]
        ),
    )

# Start the bot
StreamBot.run()
